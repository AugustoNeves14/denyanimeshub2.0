<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= episode.title %> - <%= episode.anime_title %> | Deny Animes Hub</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/player.css">
</head>
<body class="player-mode">
    <!-- Ambilight Background -->
    <div class="ambilight-container" id="ambilightContainer">
        <canvas id="ambilightCanvas"></canvas>
    </div>

    <!-- Player Interface -->
    <div class="player-wrapper">
        <video id="mainVideo" class="main-video" controls>
            <source src="<%= episode.video_url %>" type="video/mp4">
            <track kind="captions" src="<%= episode.subtitles_url %>" srclang="pt" label="Português">
        </video>

        <!-- Custom Controls -->
        <div class="player-controls" id="playerControls">
            <div class="controls-top">
                <div class="episode-info">
                    <h2 class="anime-title"><%= episode.anime_title %></h2>
                    <p class="episode-details">Episódio <%= episode.episode_number %>: <%= episode.title %></p>
                </div>
                
                <div class="player-actions">
                    <button class="control-btn" id="theaterModeBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M5 3h14c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2zm0 2v14h14V5H5z" fill="currentColor"/>
                        </svg>
                    </button>
                    
                    <button class="control-btn" id="fullscreenBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" fill="currentColor"/>
                        </svg>
                    </button>
                    
                    <button class="control-btn" id="settingsBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="controls-center">
                <button class="play-pause-btn" id="playPauseBtn">
                    <svg class="play-icon" width="48" height="48" viewBox="0 0 24 24" fill="none">
                        <path d="M8 5v14l11-7L8 5z" fill="currentColor"/>
                    </svg>
                    <svg class="pause-icon" width="48" height="48" viewBox="0 0 24 24" fill="none">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" fill="currentColor"/>
                    </svg>
                </button>
            </div>

            <div class="controls-bottom">
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-loaded" id="progressLoaded"></div>
                        <div class="progress-played" id="progressPlayed"></div>
                        <div class="progress-handle" id="progressHandle"></div>
                    </div>
                </div>

                <div class="controls-row">
                    <div class="time-controls">
                        <span class="time-current" id="timeCurrent">0:00</span>
                        <span class="time-separator">/</span>
                        <span class="time-total" id="timeTotal">0:00</span>
                    </div>

                    <div class="volume-controls">
                        <button class="volume-btn" id="volumeBtn">
                            <svg class="volume-high" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="currentColor"/>
                            </svg>
                        </button>
                        <div class="volume-slider" id="volumeSlider">
                            <div class="volume-bar" id="volumeBar"></div>
                            <div class="volume-handle" id="volumeHandle"></div>
                        </div>
                    </div>

                    <div class="playback-controls">
                        <button class="playback-btn" id="skipBackBtn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z" fill="currentColor"/>
                            </svg>
                        </button>
                        
                        <button class="playback-btn" id="skipForwardBtn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M4 18l8.5-6L4 6v12zm8.5-6L21 6v12l-8.5-6z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Episode Sidebar -->
        <aside class="episode-sidebar" id="episodeSidebar">
            <div class="sidebar-header">
                <h3>Episódios</h3>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            
            <div class="episode-list">
                <% for(let i = 1; i <= episode.total_episodes; i++) { %>
                    <div class="episode-item <%= i === episode.episode_number ? 'active' : '' %>">
                        <div class="episode-thumbnail">
                            <img src="/images/episodes/<%= episode.anime_id %>/<%= i %>.jpg" alt="Episódio <%= i %>">
                            <div class="episode-overlay">
                                <span class="episode-number"><%= i %></span>
                            </div>
                        </div>
                        <div class="episode-details">
                            <h4 class="episode-title">Episódio <%= i %></h4>
                            <p class="episode-duration">23 min</p>
                        </div>
                    </div>
                <% } %>
            </div>
        </aside>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Configurações</h3>
                <button class="settings-close" id="settingsClose">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
            
            <div class="settings-content">
                <div class="settings-section">
                    <h4>Qualidade</h4>
                    <div class="quality-options">
                        <button class="quality-btn active" data-quality="1080">1080p</button>
                        <button class="quality-btn" data-quality="720">720p</button>
                        <button class="quality-btn" data-quality="480">480p</button>
                        <button class="quality-btn" data-quality="360">360p</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Velocidade</h4>
                    <div class="speed-options">
                        <button class="speed-btn" data-speed="0.5">0.5x</button>
                        <button class="speed-btn" data-speed="0.75">0.75x</button>
                        <button class="speed-btn active" data-speed="1">1x</button>
                        <button class="speed-btn" data-speed="1.25">1.25x</button>
                        <button class="speed-btn" data-speed="1.5">1.5x</button>
                        <button class="speed-btn" data-speed="2">2x</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Legendas</h4>
                    <div class="subtitle-options">
                        <button class="subtitle-btn active" data-subtitle="pt">Português</button>
                        <button class="subtitle-btn" data-subtitle="en">Inglês</button>
                        <button class="subtitle-btn" data-subtitle="off">Desativar</button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>Áudio</h4>
                    <div class="audio-options">
                        <button class="audio-btn active" data-audio="jp">Japonês</button>
                        <button class="audio-btn" data-audio="pt">Português</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <p class="loading-text">Carregando episódio...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/js/player.js"></script>
    <script src="/js/ambilight.js"></script>
</body>
</html>